% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/initial_CRC_SPIN_processed_merged_CRC_MCED.R
\name{process_mced_crc_data}
\alias{process_mced_crc_data}
\title{Merge CRC-SPIN and MCED simulation outputs for a specified scenario}
\usage{
process_mced_crc_data(scenario_name, mced_data_dir, crc_data_path)
}
\arguments{
\item{scenario_name}{Must be one of:
\code{"control"}, \code{"colonoscopy"}, \code{"annual_fit"},
\code{"CRC_single_cancer_annual"}, \code{"CRC_single_cancer_biennial"},
\code{"CRC_single_cancer_triennial"},
\code{"mced_annual"}, \code{"mced_biennial"}, \code{"mced_triennial"},
\code{"MCED_annual_no_CRC"}, \code{"MCED_biennial_no_CRC"}, \code{"MCED_triennial_no_CRC"}.}

\item{mced_data_dir}{Path to directory containing MCED combined result files named like
\code{mced_scenario_<id>_combined_results.Rdata}, where \code{id} is:
\itemize{
\item 1 for annual scenarios
\item 2 for biennial scenarios
\item 3 for triennial scenarios
}}

\item{crc_data_path}{Path to an \code{.RData} file that contains \code{crc_list}, a named list
of CRC-SPIN processed scenario data frames keyed by \code{scenario_name}.}
}
\value{
A named \code{list} with components:
\itemize{
\item \code{joined_data}: merged person-level dataset combining MCED and CRC-SPIN outputs
\item \code{excess_cancers}: MCED primary cancers for individuals whose primary assignment
becomes CRC (treated as additional cancers)
\item \code{combined_additional_results}: MCED additional cancer dataset filtered/updated
to align with \code{joined_data} and updated other-cause death time
\item \code{scenario}: the input \code{scenario_name}
}
}
\description{
Loads MCED simulation output (annual/biennial/triennial) and merges it with a
preprocessed CRC-SPIN scenario dataset (stored in \code{crc_list} inside an \code{.RData} file).
Individuals are aligned by sorting by sex, assigning a synthetic \code{new_ID} within each dataset,
and joining MCED and CRC records on \code{new_ID}. Sex-mismatched pairs are removed after the join.
}
\details{
The function supports two main classes of scenarios:
\itemize{
\item \strong{Clinical scenarios} (\code{control}, \code{colonoscopy}, \code{annual_fit},
\code{CRC_single_cancer_*}): CRC diagnosis/death/stage are treated as "clinical"
variables in CRC-SPIN and merged into MCED outputs for non-CRC cancers.
\item \strong{Screen scenarios} (\code{mced_*}, \code{MCED_*_no_CRC}): CRC diagnosis/death/stage
are treated as "screen" variables and merged into MCED outputs in a manner consistent with
MCED screening assumptions.
}

After merging, the function overwrites MCED \code{other_cause_death_time} with the CRC-SPIN value,
determines whether CRC becomes the primary cancer site, moves displaced MCED primaries to an
\code{excess_cancers} dataset, and updates \code{combined_additional_results} to match the final cohort.

After merging, the function:
\itemize{
\item uses CRC-SPIN \code{other_cause_death_time} to overwrite MCED other-cause death time
\item determines whether CRC becomes the primary cancer site (if CRC diagnosis precedes
other-cause death and no earlier primary cancer exists per MCED timing)
\item flags individuals with both a primary CRC assignment and an MCED primary cancer
prior to other-cause death, exporting the MCED cancer as an "excess/additional" cancer
\item updates \code{combined_additional_results} to use CRC-SPIN other-cause death time and
filters additional cancers to match the final joined cohort
}

This function expects the MCED \code{.Rdata} file to load objects named
\code{combined_first_results} and \code{combined_additional_results}.
It also expects the CRC \code{.RData} to load an object named \code{crc_list}.

The merge uses \code{sex} ordering and assigns \code{new_ID = seq_len(n)} separately
to MCED and CRC datasets after sorting by \code{sex}. Individuals with sex mismatches
between MCED and CRC after joining are removed for internal consistency.
}
\examples{
\dontrun{
res <- process_mced_crc_data(
  scenario_name = "mced_annual",
  mced_data_dir  = "path/to/MCED_data",
  crc_data_path  = "path/to/crc_spin_initial_process_data.RData"
)

head(res$joined_data)
}


}
